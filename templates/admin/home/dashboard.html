{% extends 'admin/base/base.html' %}

{% block content %}
<div class="app-main flex-column flex-row-fluid " id="kt_app_main">
    <div class="d-flex flex-column flex-column-fluid">
        <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
            <div id="kt_app_toolbar_container" class="app-container  container-xxl d-flex flex-stack">
                <div  class="page-title d-flex flex-column justify-content-center flex-wrap me-3 ">
                    <h1 class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0">Dashboard</h1>
                    <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                        <li class="breadcrumb-item text-muted">
                            <a href="{% url 'admin_dashboard' %}" class="text-muted text-hover-primary">
                                Home
                            </a>
                        </li>
                        <li class="breadcrumb-item">
                            <span class="bullet bg-gray-500 w-5px h-2px"></span>
                        </li>
                        <li class="breadcrumb-item text-muted">Dashboard</li>
                    </ul>
                </div>
                
                <div class="d-flex align-items-center gap-2 gap-lg-3">
                    <a href="#" class="btn btn-sm fw-bold btn-secondary">
                        Manage Sales
                    </a>
                    <a href="#" class="btn btn-sm fw-bold btn-primary" >
                        Add New Cars
                    </a>
                </div>
            </div>
        </div>

        <div id="kt_app_content" class="app-content flex-column-fluid">
            <div id="kt_app_content_container" class="app-container container-xxl">
                <div class="row g-2 g-xl-5 mb-xl-10">
                    <div class="col-lg-6 col-xl-6 col-xxl-3 mb-md-5 mb-xl-10">
                        <div class="card card-flush h-md-50 mb-5 mb-xl-10">
                            <div class="card-header pt-5">
                                <div class="card-title d-flex flex-column">
                                    <div class="d-flex align-items-center">
                                        <span class="fs-4 fw-semibold text-gray-500 me-1 align-self-start">AED</span>
                                        <span class="fs-2hx fw-bold text-gray-900 me-2 lh-1 ls-n2">{{net_income}}</span>
                                    </div>
                                    <span class="text-gray-500 pt-1 fw-semibold fs-6">Total Earnings</span>
                                </div>
                            </div>

                            <div class="card-body pt-2 pb-4 d-flex align-items-center">
                                <div class="d-flex flex-center me-3 pt-2">
                                    <div id="chartContainer" style="height: 160px; width: 120px;"></div>
                                </div>
                                <div class="d-flex flex-column content-justify-center w-100">
                                    <div class="d-flex fs-6 fw-semibold align-items-center">
                                        <div class="bullet w-8px h-6px rounded-2 bg-primary me-3"></div>
                                        <div class="text-gray-500 flex-grow-1 me-4">Cash</div>
                                        <div class="fw-bolder text-gray-700 text-xxl-end">{{get_cash_amount}}</div>
                                    </div>
                                    <div class="d-flex fs-6 fw-semibold align-items-center my-3">
                                        <div class="bullet w-8px h-6px rounded-2 bg-danger me-3"></div>
                                        <div class="text-gray-500 flex-grow-1 me-4">Bank</div>
                                        <div class="fw-bolder text-gray-700 text-xxl-end">{{get_bank_amount}}</div>
                                    </div>
                                    <div class="d-flex fs-6 fw-semibold align-items-center">
                                        <div class="bullet w-8px h-6px rounded-2 me-3 bg-warning"></div>
                                        <div class="text-gray-500 flex-grow-1 me-4">Security</div>
                                        <div class=" fw-bolder text-gray-700 text-xxl-end">{{get_security_amount}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card card-flush h-md-50 mb-xl-10">
                            <div class="card-header pt-5">
                                <div class="card-title d-flex flex-column">   
                                    <div class="d-flex align-items-center">
                                        <span class="fs-2hx fw-bold text-gray-900 me-2 lh-1 ls-n2">{{total_orders}}</span>
                                    </div>
                                    <span class="text-gray-500 pt-1 fw-semibold fs-6">Orders This Month</span>             
                                </div>
                            </div>
                            <div class="card-body d-flex align-items-end pt-0">
                                <div class="d-flex align-items-center flex-column mt-3 w-100">
                                    <div class="d-flex justify-content-between w-100 mt-auto mb-2">
                                        <span class="fw-bolder fs-6 text-gray-900">{{total_orders_goal}} to Goal</span>
                                        <span class="fw-bold fs-6 text-gray-500">{{total_goals_percentage}}%</span>
                                    </div>
                                    <div class="h-8px mx-3 w-100 bg-light-success rounded">
                                        <div class="bg-success rounded h-8px" role="progressbar" style="width: {{total_goals_percentage}}%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6 col-xl-6 col-xxl-3 mb-md-5 mb-xl-10">
                        <div class="card card-flush h-md-50 mb-5 mb-xl-10">
                            <div class="card-header pt-5">
                                <div class="card-title d-flex flex-column">   
                                    <div class="d-flex align-items-center">
                                        <span class="fs-4 fw-semibold text-gray-500 me-1 align-self-start">AED</span>
                                        <span class="fs-2hx fw-bold text-gray-900 me-2 lh-1 ls-n2">{{average_booking}}</span>
                                        <span class="badge {% if booking_percentage > 0 %}badge-light-success{% else %}badge-light-danger{% endif %} fs-base">                                
                                            <i class="ki-duotone {% if booking_percentage > 0 %}ki-arrow-up text-success{% else %}ki-arrow-down text-danger{% endif %} fs-5 ms-n1"><span class="path1"></span><span class="path2"></span></i> 
                                            {{booking_percentage}}%
                                        </span>
                                    </div>
                                    <span class="text-gray-500 pt-1 fw-semibold fs-6">Today's Booking</span>
                                </div>
                            </div>
                            <div class="card-body d-flex align-items-end px-0 pb-0">       
                                <div id="columnchart_material" style="height: 150px; width: 300px;"></div>
                            </div>
                        </div>
                        <div class="card card-flush h-md-50 mb-xl-10">
                            <div class="card-header pt-5">
                                <div class="card-title d-flex flex-column">                
                                    <span class="fs-2hx fw-bold text-gray-900 me-2 lh-1 ls-n2">{{total_users_count}}+</span>
                                    <span class="text-gray-500 pt-1 fw-semibold fs-6">New Customers This Year</span>
                                </div>
                            </div>
                            <div class="card-body d-flex flex-column justify-content-end pe-0">
                                <span class="fs-6 fw-bolder text-gray-800 d-block mb-2">Total Users</span>
                                <div class="symbol-group symbol-hover flex-nowrap">
                                    {% for user in total_users %}
                                    <div class="symbol symbol-35px symbol-circle" data-bs-toggle="tooltip" title="{{user.first_name}} {{user.last_name}}">
                                        {% if not user.profile.profile_image %}
                                        <span class="symbol-label bg-warning text-inverse-warning fw-bold">{{user.first_name|slice:":1"}}</span>
                                        {% else %}
                                        <img alt="Pic" src="{{user.profile.profile_image.url}}" />
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                    <a href="#" class="symbol symbol-35px symbol-circle"  data-bs-toggle="modal" data-bs-target="#kt_modal_view_users">
                                        <span class="symbol-label bg-light text-gray-400 fs-8 fw-bold">+{{total_users_count}}</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12 col-xl-12 col-xxl-6 mb-5 mb-xl-0">
                        <div class="card card-flush overflow-hidden h-md-100">
                            <div class="card-header py-5">
                                <h3 class="card-title align-items-start flex-column">            
                                    <span class="card-label fw-bold text-gray-900">Sales This Months</span>
                                    <span class="text-gray-500 mt-1 fw-semibold fs-6">Users from all channels</span>
                                </h3>
                            </div>
                            <div class="card-body d-flex justify-content-between flex-column pb-1 px-0">  
                                <div class="px-9 mb-5">   
                                    <div class="d-flex mb-2">   
                                        <span class="fs-4 fw-semibold text-gray-500 me-1">AED</span>
                                        <span class="fs-2hx fw-bold text-gray-800 me-2 lh-1 ls-n2">{{total_income}}</span>                
                                    </div>
                                </div>
                                <div id="kt_charts_widget_3" class="min-h-auto ps-4 pe-6" style="height: 300px"></div>
                            </div>
                        </div>
                    </div>
                </div>
                                    
    <div id="kt_app_footer" class="app-footer">
        <div class="app-container  container-fluid d-flex flex-column flex-md-row flex-center flex-md-stack py-3 ">
            <div class="text-gray-900 order-2 order-md-1">
                <span class="text-muted fw-semibold me-1">2024&copy;</span>
                <a href="/" target="_blank" class="text-gray-800 text-hover-primary">Sandcity Car Rental Pvt. Ltd</a>
            </div>
            <ul class="menu menu-gray-600 menu-hover-primary fw-semibold order-1">
                <li class="menu-item"><a href="{% url 'about_us' %}" target="_blank" class="menu-link px-2">About</a></li>
                <li class="menu-item"><a href="#" target="_blank" class="menu-link px-2">Support</a></li>
            </ul>
        </div>
    </div>

</div>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load("current", {'packages':["corechart"]});
    google.charts.setOnLoadCallback(drawChart);
    var cash = '{{get_cash_amount}}'
    var bank = '{{get_bank_amount}}'
    var security = '{{get_security_amount}}'
    function drawChart() {
      var data = google.visualization.arrayToDataTable([
        ['Task', 'Hours per Day'],
        ['Cash',     parseInt(cash)],
        ['Bank',      parseInt(bank)],
        ['Security',  parseInt(security)]
      ]);

      var options = {
        pieHole: 0.6,
        legend: 'none'
      };

      var chart = new google.visualization.PieChart(document.getElementById('chartContainer'));
      chart.draw(data, options);
    }

    google.charts.load('current', {'packages':['bar']});
    google.charts.setOnLoadCallback(drawColumn);

    function drawColumn() {
        var data = google.visualization.arrayToDataTable([
          ['Date', 'Daily Booking'],
          {% for booking in bookings %}
          ['{{booking.created_at__date|date:"d M"}}', {{booking.total_sales}}],
          {% endfor %}
        ]);

        var options = {
            legend: { position: 'none' },
            axes: {
                x: {
                    0: { side: 'top', label: '', color: 'green'}, // Top x-axis.
                }
            },
            bar: { groupWidth: "50%" },
        };

        var chart = new google.charts.Bar(document.getElementById('columnchart_material'));

        chart.draw(data, google.charts.Bar.convertOptions(options));
    }
</script>
{% endblock %}
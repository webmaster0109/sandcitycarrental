{% extends 'admin/base/base.html' %}

{% block content %}
<div class="pc-container">
    <div class="pc-content">
      <!-- [ breadcrumb ] start -->
      <div class="page-header">
        <div class="page-block">
          <div class="row align-items-center">
            <div class="col-md-12">
              <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'admin_dashboard' %}">Home</a></li>
                <li class="breadcrumb-item"><a href="javascript: void(0)">CRM Application</a></li>
                <li class="breadcrumb-item" aria-current="page">Car Features</li>
              </ul>
            </div>
            <div class="col-md-12">
              <div class="page-header-title">
                <h2 class="mb-0">Car Features</h2>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- [ breadcrumb ] end -->

      <div class="row">
        <div class="col-sm-7">    
            <div class="card">
                <div class="card-header pb-0">
                  <ul class="nav nav-tabs profile-tabs mb-0" id="myTab" role="tablist">
                    {% for car in cars %}
                    <li class="nav-item" role="presentation">
                      <a class="nav-link {% if forloop.first %}active{% endif %}" id="ecomtab-tab-{{car.slug}}" data-bs-toggle="tab" href="#ecomtab-{{car.slug}}" role="tab" aria-controls="ecomtab-{{car.slug}}" aria-selected="true">{{car.brand}}
                      </a>
                    </li>
                    {% endfor %}
                  </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content">
                        {% for car in cars %}
                        <div class="tab-pane show {% if forloop.first %}active{% endif %}" id="ecomtab-{{car.slug}}" role="tabpanel" aria-labelledby="ecomtab-tab-{{car.slug}}">
                        <div class="table-responsive">
                            <table class="table table-borderless">
                            <tbody>
                                {% for feature in car.carfeatures_set.all %}
                                <tr>
                                <td class="text-muted py-1">{{feature.features}}</td>
                                <td class="py-1">
                                    <a href="#" class="btn btn-warning btn-sm me-1" data-bs-toggle="modal" data-bs-target="#feature-modal-{{feature.feature_id}}">
                                        <i class="fas fa-edit"></i> Edit</a>
                                    <a href="{% url 'delete_car_features' feature.feature_id  %}" class="btn btn-danger btn-sm" >
                                        <i class="fas fa-trash-alt"></i> Delete</a>
                                </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            </table>
                        </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
              </div>
        </div>
        <div class="col-sm-5">
            <div class="card">
                <div class="card-header">
                  <h5>Add New Car Categories</h5>
                </div>
                <div class="card-body">
                {% include 'base/includes/alerts.html' %}
                  <form method="post" action="{% url 'add_new_features' %}">
                    {% csrf_token %}
                    <div class="form-group">
                      <label class="form-label">Select Car:</label>
                      <select class="form-select" name="cars" required>
                        <option value="">Select car for feature</option>
                        {% for car in cars %}
                        <option value="{{car.brand}}">{{car.brand}}</option>
                        {% endfor %}
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Car Feature:</label>
                      <input type="text" name="features" class="form-control" placeholder="Car Feature">
                    </div>
                    <div class="form-group text-end">
                        <button type="submit" class="btn btn-warning">Add Car Feature</button>
                    </div>
                  </form>
                </div>
            </div>
        </div>
      </div>
    </div>
</div>
{% for car in cars %}
{% for feature in car.carfeatures_set.all %}
<div class="modal fade" id="feature-modal-{{feature.feature_id}}" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header border-0 pb-0">
          <h5 class="mb-0">Update {{feature.features}} features</h5>
          <a href="#" class="avtar avtar-s btn-link-danger ms-auto btn-pc-default" data-bs-dismiss="modal">
            <i class="ti ti-x f-20"></i>
          </a>
        </div>
        <div class="modal-body">
            <form method="post" action="{% url 'update_car_features' feature.feature_id %}">
                    {% csrf_token %}
                    <div class="form-group">
                      <label class="form-label">Selected Car:</label>
                      <input type="text" name="cars" class="form-control" readonly value="{{car.brand}}">
                    </div>
                    <div class="form-group">
                      <label class="form-label">Car Feature:</label>
                      <input type="text" name="features" class="form-control" value="{{feature.features}}">
                    </div>
                    <div class="form-group text-end">
                        <button type="submit" class="btn btn-warning">Update Car Feature</button>
                    </div>
            </form>
        </div>
      </div>
    </div>
</div>
{% endfor %}
{% endfor %}
{% endblock %}